<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <link rel="icon" href="/favicon.png"><title>状态管理 | 飞冰</title><meta name="description" content="飞冰（ICE），基于 React 的渐进式研发框架。"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.14">
    <link rel="preload" href="/assets/js/runtime~app.244338c9.js" as="script"><link rel="preload" href="/assets/css/styles.de9a6ac9.css" as="style"><link rel="preload" href="/assets/js/6754.6f024c79.js" as="script"><link rel="preload" href="/assets/js/app.0b40c029.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.de9a6ac9.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class=""></path></svg></div><span><a href="/" class=""><img class="logo" src="https://img.alicdn.com/tfs/TB1AI2vteOSBuNjy0FdXXbDnVXa-680-192.png" alt="飞冰"><span class="site-name can-hide">飞冰</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/guide/" class="nav-link router-link-active" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/config/" class="nav-link" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/api/" class="nav-link" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="插件"><span class="title">插件</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="插件"><span class="title">插件</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/plugin/list/antd.md" class="nav-link" aria-label="官方插件"><!--[--><!--]--> 官方插件 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/plugin/develop/start.md" class="nav-link" aria-label="插件开发"><!--[--><!--]--> 插件开发 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="物料"><span class="title">物料</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="物料"><span class="title">物料</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/fusion/" class="nav-link" aria-label="Fusion"><!--[--><!--]--> Fusion <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/antd/" class="nav-link" aria-label="Antd"><!--[--><!--]--> Antd <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/material/" class="nav-link" aria-label="自定义物料"><!--[--><!--]--> 自定义物料 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="了解更多"><span class="title">了解更多</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="了解更多"><span class="title">了解更多</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>官方生态</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a class="nav-link external" href="https://marketplace.visualstudio.com/items?itemName=iceworks-team.iceworks" rel="noopener noreferrer" target="_blank" aria-label="AppWorks"><!--[--><!--]--> AppWorks <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-subitem"><a class="nav-link external" href="https://micro-frontends.ice.work/" rel="noopener noreferrer" target="_blank" aria-label="微前端"><!--[--><!--]--> 微前端 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>前端基础</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/resource/front-env.html" class="nav-link" aria-label="前端环境配置"><!--[--><!--]--> 前端环境配置 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/resource/npms.html" class="nav-link" aria-label="社区组件推荐"><!--[--><!--]--> 社区组件推荐 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/resource/front-basic.html" class="nav-link" aria-label="前端基础知识"><!--[--><!--]--> 前端基础知识 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>社区交流</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a class="nav-link external" href="https://img.alicdn.com/tfs/TB134cdVq6qK1RjSZFmXXX0PFXa-1125-1485.jpg" rel="noopener noreferrer" target="_blank" aria-label="钉钉群"><!--[--><!--]--> 钉钉群 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/alibaba/ice" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><div class="search-box"><input placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></div></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/guide/" class="nav-link router-link-active" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/config/" class="nav-link" aria-label="配置"><!--[--><!--]--> 配置 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/api/" class="nav-link" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="插件"><span class="title">插件</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="插件"><span class="title">插件</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/plugin/list/antd.md" class="nav-link" aria-label="官方插件"><!--[--><!--]--> 官方插件 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/plugin/develop/start.md" class="nav-link" aria-label="插件开发"><!--[--><!--]--> 插件开发 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="物料"><span class="title">物料</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="物料"><span class="title">物料</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/fusion/" class="nav-link" aria-label="Fusion"><!--[--><!--]--> Fusion <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/antd/" class="nav-link" aria-label="Antd"><!--[--><!--]--> Antd <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/material/" class="nav-link" aria-label="自定义物料"><!--[--><!--]--> 自定义物料 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="了解更多"><span class="title">了解更多</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="了解更多"><span class="title">了解更多</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>官方生态</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a class="nav-link external" href="https://marketplace.visualstudio.com/items?itemName=iceworks-team.iceworks" rel="noopener noreferrer" target="_blank" aria-label="AppWorks"><!--[--><!--]--> AppWorks <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-subitem"><a class="nav-link external" href="https://micro-frontends.ice.work/" rel="noopener noreferrer" target="_blank" aria-label="微前端"><!--[--><!--]--> 微前端 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>前端基础</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/resource/front-env.html" class="nav-link" aria-label="前端环境配置"><!--[--><!--]--> 前端环境配置 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/resource/npms.html" class="nav-link" aria-label="社区组件推荐"><!--[--><!--]--> 社区组件推荐 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/resource/front-basic.html" class="nav-link" aria-label="前端基础知识"><!--[--><!--]--> 前端基础知识 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>社区交流</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a class="nav-link external" href="https://img.alicdn.com/tfs/TB134cdVq6qK1RjSZFmXXX0PFXa-1125-1485.jpg" rel="noopener noreferrer" target="_blank" aria-label="钉钉群"><!--[--><!--]--> 钉钉群 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/alibaba/ice" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><section class="sidebar-group"><p class="sidebar-heading active"></p><ul class=""><li><!--[--><a href="/guide/" class="nav-link router-link-active sidebar-link" aria-label="关于飞冰"><!--[--><!--]--> 关于飞冰 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading active">基础指南</p><ul class="sidebar-sub-headers"><li><!--[--><a href="/guide/basic/structure.html" class="nav-link sidebar-link" aria-label="目录结构"><!--[--><!--]--> 目录结构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/app.html" class="nav-link sidebar-link" aria-label="应用入口"><!--[--><!--]--> 应用入口 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/router.html" class="nav-link sidebar-link" aria-label="路由配置"><!--[--><!--]--> 路由配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/menu.html" class="nav-link sidebar-link" aria-label="菜单配置"><!--[--><!--]--> 菜单配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/request.html" class="nav-link sidebar-link" aria-label="数据请求"><!--[--><!--]--> 数据请求 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-link active" aria-label="状态管理"><!--[--><!--]--> 状态管理 <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/guide/basic/store.html#全局应用状态" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="全局应用状态"><!--[--><!--]--> 全局应用状态 <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/guide/basic/store.html#定义-model" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="定义 Model"><!--[--><!--]--> 定义 Model <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#初始化-store" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="初始化 Store"><!--[--><!--]--> 初始化 Store <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#在-view-中使用模型状态" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="在 View 中使用模型状态"><!--[--><!--]--> 在 View 中使用模型状态 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#页面级状态" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="页面级状态"><!--[--><!--]--> 页面级状态 <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/guide/basic/store.html#嵌套页面" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="嵌套页面"><!--[--><!--]--> 嵌套页面 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#参阅资料" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="参阅资料"><!--[--><!--]--> 参阅资料 <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/guide/basic/store.html#设置初始状态" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="设置初始状态"><!--[--><!--]--> 设置初始状态 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#typescript-类型提示" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="TypeScript 类型提示"><!--[--><!--]--> TypeScript 类型提示 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#model-定义详细说明" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="model 定义详细说明"><!--[--><!--]--> model 定义详细说明 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#model-之间通信" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="model 之间通信"><!--[--><!--]--> model 之间通信 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#获取-effects-的状态-loading-error" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="获取 effects 的状态 loading/error"><!--[--><!--]--> 获取 effects 的状态 loading/error <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#在-class-component-中使用" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="在 Class Component 中使用"><!--[--><!--]--> 在 Class Component 中使用 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#路由切换后重置页面状态" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="路由切换后重置页面状态"><!--[--><!--]--> 路由切换后重置页面状态 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#redux-devtools" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Redux Devtools"><!--[--><!--]--> Redux Devtools <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#在其他地方使用-store" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="在其他地方使用 store"><!--[--><!--]--> 在其他地方使用 store <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/guide/basic/store.html#版本变更说明" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="版本变更说明"><!--[--><!--]--> 版本变更说明 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/guide/basic/build.html" class="nav-link sidebar-link" aria-label="工程配置"><!--[--><!--]--> 工程配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/config.html" class="nav-link sidebar-link" aria-label="环境配置"><!--[--><!--]--> 环境配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/page.html" class="nav-link sidebar-link" aria-label="页面配置"><!--[--><!--]--> 页面配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/style.html" class="nav-link sidebar-link" aria-label="样式方案"><!--[--><!--]--> 样式方案 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/component.html" class="nav-link sidebar-link" aria-label="编写组件"><!--[--><!--]--> 编写组件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/logger.html" class="nav-link sidebar-link" aria-label="日志打印"><!--[--><!--]--> 日志打印 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/start.html" class="nav-link sidebar-link" aria-label="快速开始"><!--[--><!--]--> 快速开始 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/basic/upgrade.html" class="nav-link sidebar-link" aria-label="版本升级"><!--[--><!--]--> 版本升级 <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading">进阶知识</p><ul class="sidebar-sub-headers"><li><!--[--><a href="/guide/advanced/mpa.html" class="nav-link sidebar-link" aria-label="多页应用 MPA"><!--[--><!--]--> 多页应用 MPA <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/ssr.html" class="nav-link sidebar-link" aria-label="服务端渲染 SSR"><!--[--><!--]--> 服务端渲染 SSR <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/icestark.html" class="nav-link sidebar-link" aria-label="微前端 icestark"><!--[--><!--]--> 微前端 icestark <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/faas.html" class="nav-link sidebar-link" aria-label="前后端一体化 Serverless"><!--[--><!--]--> 前后端一体化 Serverless <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/prerender.html" class="nav-link sidebar-link" aria-label="构建时预渲染 Prerender"><!--[--><!--]--> 构建时预渲染 Prerender <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/code-splitting.html" class="nav-link sidebar-link" aria-label="代码分割 Code Splitting"><!--[--><!--]--> 代码分割 Code Splitting <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/error-boundaries.html" class="nav-link sidebar-link" aria-label="错误边界 Error Boundaries"><!--[--><!--]--> 错误边界 Error Boundaries <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/auth.html" class="nav-link sidebar-link" aria-label="权限管理"><!--[--><!--]--> 权限管理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/convention-routing.html" class="nav-link sidebar-link" aria-label="约定式路由"><!--[--><!--]--> 约定式路由 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/mock.html" class="nav-link sidebar-link" aria-label="本地 Mock 数据"><!--[--><!--]--> 本地 Mock 数据 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/proxy.html" class="nav-link sidebar-link" aria-label="本地 Proxy 方案"><!--[--><!--]--> 本地 Proxy 方案 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/test.html" class="nav-link sidebar-link" aria-label="编写单元测试"><!--[--><!--]--> 编写单元测试 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/publish.html" class="nav-link sidebar-link" aria-label="前端资源发布"><!--[--><!--]--> 前端资源发布 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/quality.html" class="nav-link sidebar-link" aria-label="代码质量保障"><!--[--><!--]--> 代码质量保障 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/backend.html" class="nav-link sidebar-link" aria-label="后端应用集成"><!--[--><!--]--> 后端应用集成 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/guide/advanced/statistical.html" class="nav-link sidebar-link" aria-label="页面埋点统计数据"><!--[--><!--]--> 页面埋点统计数据 <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><p>icejs 内置了状态管理方案，并在此基础上进一步遵循 <strong>“约定优于配置”</strong> 原则，进行抽象和封装，使得状态管理变得非常容易。</p><h2 id="全局应用状态"><a class="header-anchor" href="#全局应用状态">#</a> 全局应用状态</h2><h3 id="定义-model"><a class="header-anchor" href="#定义-model">#</a> 定义 Model</h3><p>约定全局状态位于 <code>src/models</code> 目录，目录结构如下：</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>src
├── models               // 全局状态
|   ├── counter.ts
│   └── user.ts
└── store.ts
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>假设我们需要全局管理用户状态，定义模型如下：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// src/models/user.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token punctuation">(</span>time<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 定义 model 的初始 state</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 定义改变该模型状态的纯函数</span>
  reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">update</span> <span class="token punctuation">(</span>prevState<span class="token punctuation">,</span> payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>prevState<span class="token punctuation">,</span>
        <span class="token operator">...</span>payload<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 定义处理该模型副作用的函数</span>
  <span class="token function-variable function">effects</span><span class="token operator">:</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">getUserInfo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      dispatch<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&#39;taobao&#39;</span><span class="token punctuation">,</span>
        id<span class="token operator">:</span> <span class="token string">&#39;123&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="初始化-store"><a class="header-anchor" href="#初始化-store">#</a> 初始化 Store</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// src/store.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ice&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> user <span class="token keyword">from</span> <span class="token string">&#39;./models/user&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> project <span class="token keyword">from</span> <span class="token string">&#39;./models/project&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  user<span class="token punctuation">,</span>
  project<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// options</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>createStore()</code> 支持的 options:</p><ul><li>disableImmer：布尔类型，可选，默认值 false，如果设置为 true，那么 immer 将被禁用，这意味着不能再在 reducers 中直接改变状态，而是必须返回新的状态。</li><li>disableError：布尔类型，可选，默认值 false，如果设置为 true，则 <code>UseModelEffectsError</code> 和 <code>WithModelEffectsError</code> 将不可用。</li><li>disableLoading：布尔类型，可选，默认值 false，如果设置为 true，则 <code>useModelEffectsLoading</code> 和 <code>withModelEffectsLoading</code> 将不可用。</li><li>plugins：数组类型，可选，Redux 插件</li><li>redux：对象类型，可选 <ul><li>middlewares：数组类型，Redux middlewares</li><li>devtoolOptions：对象类型，Redux Devtools 参数</li></ul></li></ul><h3 id="在-view-中使用模型状态"><a class="header-anchor" href="#在-view-中使用模型状态">#</a> 在 View 中使用模型状态</h3><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import store from &#39;@/store&#39;;
</span></span>
const HomePage = () =&gt; {
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  const [userState, userDispatchers] = store.useModel(&#39;user&#39;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> return (
</span><span class="token prefix unchanged"> </span><span class="token line">   &lt;&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">     &lt;span&gt;{userState.id}&lt;/span&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">     &lt;span&gt;{userState.name}&lt;/span&gt;
</span><span class="token prefix unchanged"> </span><span class="token line">   &lt;/&gt;
</span><span class="token prefix unchanged"> </span><span class="token line"> );
</span></span>}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="页面级状态"><a class="header-anchor" href="#页面级状态">#</a> 页面级状态</h2><p>页面状态只能在该页面下的组件中使用，无法跨页面使用。约定页面状态在 <code>src/pages/*/models</code> 中定义。</p><p>目录组织如下：</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>src
├── models                  // 全局状态
│   └── user.ts
└── pages
|   ├── Home                // Home 页面
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">|   │   ├── models          // 页面状态
</span><span class="token prefix inserted">+</span><span class="token line">|   │   |   ├── foo.ts
</span><span class="token prefix inserted">+</span><span class="token line">|   │   |   └── bar.ts
</span><span class="token prefix inserted">+</span><span class="token line">|   │   ├── store.ts
</span></span>|   │   └── index.tsx
└── app.ts
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>定义模型如下：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// src/pages/Home/models/foo.ts</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&#39;Hello&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>初始化 Store 实例：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// src/pages/Home/store.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ice&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">&#39;./models/foo&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在页面组件中使用模型状态：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// 引用页面状态</span>
<span class="token keyword">import</span> pageStore <span class="token keyword">from</span> <span class="token string">&#39;@/pages/Home/store&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">HomePage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>pageState<span class="token punctuation">,</span> pageDispatchers<span class="token punctuation">]</span> <span class="token operator">=</span> pageStore<span class="token punctuation">.</span><span class="token function">useModel</span><span class="token punctuation">(</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>pageState<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">// Hello</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="嵌套页面"><a class="header-anchor" href="#嵌套页面">#</a> 嵌套页面</h3><p>某些复杂场景会出现嵌套页面的情况，即 <code>src/pages/Home</code> 下<strong>包含多个路由页面</strong>，目录组织如下：</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>src
└── pages
│   ├── Home                 // Home 页面包含了 Foo、Bar 等多个路由页面
│   │   ├── Foo        
│   │   ├── Bar
│   │   ├── Layout           // 页面布局
│   │   │  └── index.tsx
│   │   ├── models           // 页面状态
│   │   │   ├── Foo.ts
│   │   │   └── Bar.ts
│   │   └── store.ts
└── app.ts
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>对于嵌套页面，框架会将 store 的 Provider 包裹在 <code>Layout/index.tsx</code> 上，因此需要保证该文件的存在：</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// Layout/index.tsx</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>同时配置在 <code>src/routes.ts</code> 中：</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>// src/routes.ts
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import HomeLayout from &#39;@/pages/Home/Layout&#39;;
</span></span>import Foo from &#39;@/pages/Home/Foo&#39;;
import Bar from &#39;@/pages/Home/Bar&#39;;
import About from &#39;@/pages/About&#39;;

export default [
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> {
</span><span class="token prefix unchanged"> </span><span class="token line">   path: &#39;/&#39;,
</span><span class="token prefix unchanged"> </span><span class="token line">   component: BasicLayout,
</span><span class="token prefix unchanged"> </span><span class="token line">   children: [
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       path: &#39;/home&#39;,
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">        component: HomeLayout,
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       children: [
</span><span class="token prefix unchanged"> </span><span class="token line">         {
</span><span class="token prefix unchanged"> </span><span class="token line">           path: &#39;/foo&#39;,
</span><span class="token prefix unchanged"> </span><span class="token line">           component: Foo
</span><span class="token prefix unchanged"> </span><span class="token line">         }
</span><span class="token prefix unchanged"> </span><span class="token line">       ]
</span><span class="token prefix unchanged"> </span><span class="token line">     },
</span><span class="token prefix unchanged"> </span><span class="token line">     {
</span><span class="token prefix unchanged"> </span><span class="token line">       path: &#39;/about&#39;,
</span><span class="token prefix unchanged"> </span><span class="token line">       component: About,
</span><span class="token prefix unchanged"> </span><span class="token line">     }
</span><span class="token prefix unchanged"> </span><span class="token line">   ]
</span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span>]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="参阅资料"><a class="header-anchor" href="#参阅资料">#</a> 参阅资料</h2><h3 id="设置初始状态"><a class="header-anchor" href="#设置初始状态">#</a> 设置初始状态</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> runApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ice&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> appConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  store<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 可选，初始化状态</span>
    initialStates<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">runApp</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>API <code>store.getInitialStates</code> 已废弃，推荐使用 <code>store.initialStates</code></p></blockquote><blockquote><p>SSR 场景下 <code>initialData.initialStates</code> 会默认赋值给 <code>store.initialStates</code></p></blockquote><blockquote><p>页面级状态目前不支持设置 initialStates</p></blockquote><h3 id="typescript-类型提示"><a class="header-anchor" href="#typescript-类型提示">#</a> TypeScript 类型提示</h3><p>编写类型有助于更好的代码提示，类型定义步骤如下：</p><ul><li>创建 Store 实例</li></ul><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>// src/store.ts
import { createStore, IStoreModels, IStoreDispatch, IStoreRootState } from &#39;ice&#39;;
import user from &#39;./models/user&#39;;
import porject from &#39;./models/porject&#39;;

<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">interface IAppStoreModels extends IStoreModels {
</span><span class="token prefix inserted">+</span><span class="token line">  user: typeof user;
</span><span class="token prefix inserted">+</span><span class="token line">  project: typeof project;
</span><span class="token prefix inserted">+</span><span class="token line">};
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">const appModels: IAppStoreModels = {
</span><span class="token prefix inserted">+</span><span class="token line">  user,
</span><span class="token prefix inserted">+</span><span class="token line">  project,
</span><span class="token prefix inserted">+</span><span class="token line">};
</span></span>
export default createStore(appModels);

<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">export type IRootDispatch = IStoreDispatch&lt;typeof appModels&gt;;
</span><span class="token prefix inserted">+</span><span class="token line">export type IRootState = IStoreRootState&lt;typeof appModels&gt;;
</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>定义状态模型</li></ul><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>// src/models/user.ts
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import { IRootState, IRootDispatch } from &#39;@/store&#39;;
</span></span>
const user = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> state: [],
</span><span class="token prefix unchanged"> </span><span class="token line"> reducers: {},
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  effects: ((dispatch: IRootDispatch) =&gt; ({
</span><span class="token prefix inserted">+</span><span class="token line">    like(playload, rootState: IRootState) {
</span><span class="token prefix inserted">+</span><span class="token line">      dispatch.project.foo(payload); // 调用其他 model 的 effects/reducers
</span><span class="token prefix inserted">+</span><span class="token line">      rootState.project.title;       // 获取其他 model 的 state
</span><span class="token prefix inserted">+</span><span class="token line">    }
</span><span class="token prefix inserted">+</span><span class="token line">  })
</span></span>};
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="model-定义详细说明"><a class="header-anchor" href="#model-定义详细说明">#</a> model 定义详细说明</h3><p>如上示例所述，icejs 约定在 <code>src/models</code>、<code>src/pages/*/models</code> 目录下的文件为项目定义的模型文件，每个文件需要默认导出一个对象。</p><p>通常模型定义包括 state、reducers、effects 三部分：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

  reducers<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

  effects<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>state</strong></p><p>model 的初始 state</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>export default {
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> state: { count: 0 }
</span></span>}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>reducers</strong></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>reducers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span>prevState<span class="token punctuation">,</span> payload<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>一个改变该模型状态的函数集合。这些方法以模型的上一次 prevState 和一个 payload 作为入参，在方法中使用可变的方式来更新状态。这些方法应该是仅依赖于 prevState 和 payload 参数来计算下一个 nextState 的纯函数。对于有副作用的函数，请使用 effects。</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> state: { count: 0, list: [] },
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> reducers: {
</span><span class="token prefix inserted">+</span><span class="token line">   increment (prevState, payload) {
</span><span class="token prefix inserted">+</span><span class="token line">     // 
</span><span class="token prefix inserted">+</span><span class="token line">     prevState.count += 1;
</span><span class="token prefix inserted">+</span><span class="token line">     prevState.list.push(1);
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span><span class="token prefix inserted">+</span><span class="token line">   decrement (prevState) {
</span><span class="token prefix inserted">+</span><span class="token line">     prevState.count += 1;
</span><span class="token prefix inserted">+</span><span class="token line">   }
</span><span class="token prefix inserted">+</span><span class="token line"> }
</span></span>}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>icestore 默认内置了 immer，因此 reducer 中直接修改数据即可，无需返回新对象</p></blockquote><p><strong>effects</strong></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token function-variable function">effects</span><span class="token operator">:</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span>payload<span class="token punctuation">,</span> rootState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>一个可以处理该模型副作用的函数集合。这些方法以 payload 和 rootState 作为入参，适用于进行异步调用、模型联动等场景。</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> state: { count: 0 },
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> reducers: {
</span><span class="token prefix unchanged"> </span><span class="token line">   increment (prevState, payload) {
</span><span class="token prefix unchanged"> </span><span class="token line">     prevState.count += 1;
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   decrement (prevState) {
</span><span class="token prefix unchanged"> </span><span class="token line">     prevState.count -= 1;
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> effects: (dispatch) =&gt; ({
</span><span class="token prefix inserted">+</span><span class="token line">   async asyncDecrement() {
</span><span class="token prefix inserted">+</span><span class="token line">     await delay(1000);             // 进行一些异步操作
</span><span class="token prefix inserted">+</span><span class="token line">     this.increment();              // 调用模型 reducers 内的方法来更新状态
</span><span class="token prefix inserted">+</span><span class="token line">   },
</span><span class="token prefix inserted">+</span><span class="token line"> }),
</span></span>};
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="model-之间通信"><a class="header-anchor" href="#model-之间通信">#</a> model 之间通信</h3><blockquote><p>注意：如果两个 model 不属于同一个 store 实例，是无法通信的</p></blockquote><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>// src/models/user
export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> state: {
</span><span class="token prefix unchanged"> </span><span class="token line">   name: &#39;&#39;,
</span><span class="token prefix unchanged"> </span><span class="token line">   tasks: 0,
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> effects: () =&gt; ({
</span><span class="token prefix unchanged"> </span><span class="token line">   async refresh() {
</span><span class="token prefix unchanged"> </span><span class="token line">     const data = await fetch(&#39;/user&#39;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      // 通过 this.foo 调用自身的 reducer
</span><span class="token prefix inserted">+</span><span class="token line">      this.setState(data);
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> }),
</span></span>};

// src/models/tasks
export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> state: [],
</span><span class="token prefix unchanged"> </span><span class="token line"> effects: (dispatch) =&gt; ({
</span><span class="token prefix unchanged"> </span><span class="token line">   async refresh() {
</span><span class="token prefix unchanged"> </span><span class="token line">     const data = await fetch(&#39;/tasks&#39;);
</span><span class="token prefix unchanged"> </span><span class="token line">     this.setState(data);
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line">   async add(task) {
</span><span class="token prefix unchanged"> </span><span class="token line">     await fetch(&#39;/tasks/add&#39;, task);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      // 调用另一个 model user 的 effects
</span><span class="token prefix inserted">+</span><span class="token line">      await dispatch.user.refresh();
</span><span class="token prefix inserted">+</span><span class="token line">      // 通过 this.foo 调用自身的 effects
</span><span class="token prefix inserted">+</span><span class="token line">      await this.refresh();
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   },
</span><span class="token prefix unchanged"> </span><span class="token line"> }),
</span></span>};
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>在 effects 里的 action 方法中可以通过 <code>dispatch[model][action]</code> 拿到其他模型所定义的方法。</p><blockquote><p>如果遇到 <code>this.foo</code> 的 ts 类型错误，请参考文档 <a href="https://github.com/ice-lab/icestore/blob/master/docs/qna.zh-CN.md" target="_blank" rel="noopener noreferrer">icestore QA<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span></a> 进行修复</p></blockquote><blockquote><p>setState 是 icestore 内置的一个 reducer，可以直接使用</p></blockquote><h3 id="获取-effects-的状态-loading-error"><a class="header-anchor" href="#获取-effects-的状态-loading-error">#</a> 获取 effects 的状态 loading/error</h3><p>通过 <code>useModelEffectsState</code> API 即可获取到 effects 的 loading 和 error 状态。</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>import store from &#39;@/store&#39;;

function FunctionComponent() {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const [state, dispatchers] = store.useModel(&#39;counter&#39;);
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  const effectsState = store.useModelEffectsState(&#39;counter&#39;);
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> useEffect(() =&gt; {
</span><span class="token prefix unchanged"> </span><span class="token line">   dispatchers.asyncDecrement();
</span><span class="token prefix unchanged"> </span><span class="token line"> }, []);
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  console.log(effectsState.asyncDecrement.isLoading); // loading
</span><span class="token prefix inserted">+</span><span class="token line">  console.log(effectsState.asyncDecrement.error);  // error
</span></span>}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="在-class-component-中使用"><a class="header-anchor" href="#在-class-component-中使用">#</a> 在 Class Component 中使用</h3><p>useModel 相关的 API 基于 React 的 Hooks 能力，仅能在 Function Component 中使用，通过 <code>withModel</code> API 可以实现在 Class Component 中使用。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&#39;@/store&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> todos <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> state<span class="token punctuation">,</span> dispatchers <span class="token punctuation">]</span> <span class="token operator">=</span> todos<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">.</span><span class="token function">withModel</span><span class="token punctuation">(</span><span class="token string">&#39;todos&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 绑定多个 model</span>
<span class="token comment">// export default withModel(&#39;user&#39;)(withModel(&#39;todos&#39;)(TodoList));</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>同时，也可以使用 <code>withModelDispatchers</code> 以及 <code>withModelEffectsState</code> API。</p><p><a href="https://github.com/ice-lab/icestore/blob/master/docs/api.md" target="_blank" rel="noopener noreferrer">完整 API 文档<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span></a></p><h3 id="路由切换后重置页面状态"><a class="header-anchor" href="#路由切换后重置页面状态">#</a> 路由切换后重置页面状态</h3><p>在 <code>build.json</code> 中开启：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;store&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;resetPageState&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果开发者自行在 <code>store.ts</code> 中初始化 <code>store</code> 实例，需要按照以下规则进行创建：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// src/pages/Home/store.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ice&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 有 models 目录的情况</span>
<span class="token keyword">import</span> user <span class="token keyword">from</span> <span class="token string">&#39;./models/user&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> project <span class="token keyword">from</span> <span class="token string">&#39;./models/project&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 model 的文件名作为 model key</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  user<span class="token punctuation">,</span>
  project<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 有 model.ts 文件的情况</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&#39;./model&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 default 作为 model key</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> store <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="redux-devtools"><a class="header-anchor" href="#redux-devtools">#</a> Redux Devtools</h3><p>icejs 中默认集成了 <a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank" rel="noopener noreferrer">Redux Devtools<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span></a>，不需要额外的配置就可以通过 Redux Devtools 调试：</p><p><img src="https://img.alicdn.com/tfs/TB1wK4nqypE_u4jSZKbXXbCUVXa-1918-430.png" alt=""></p><p>如果想要定义 Devtools 的参数，可以查看上面 <code>createStore</code> 的 options 说明。</p><h3 id="在其他地方使用-store"><a class="header-anchor" href="#在其他地方使用-store">#</a> 在其他地方使用 store</h3><p>满足以下几种情况，框架都会自动帮助开发者包裹 <code>store.Provider</code>：</p><ul><li>SPA 全局 store：<code>src/</code> 下有 <code>store.js</code> 和 <code>app.js</code></li><li>SPA 页面级 store：<code>src/pages/Home</code> 下有 <code>store.js</code> 和 <code>index.jsx</code></li><li>SPA 嵌套页面级 store：<code>src/pages/Home</code> 下有 <code>store.js</code> 和 <code>Layout/index.jsx</code>（优先级低于上面）</li><li>MPA 组件类型的 entry：<code>src/pages/Home</code> 下有 <code>store.js</code> 和 <code>index.jsx</code></li><li>MPA 单页类型的 entry：<code>src/pages/Home</code> 下有 <code>store.js</code>, <code>app.js</code>, <code>Layout/index.jsx</code></li></ul><p>如果不满足上述情况，则需要开发者自行包裹 <code>store.Provider</code>。比如希望在 <code>src/pages/Home/Foo/</code> 下创建一个 store：</p><ol><li>在 <code>src/pages/Home/Foo/models/</code> 下定义 model</li><li>在 <code>src/pages/Home/Foo/store.ts</code> 中初始化 store</li><li><strong>新增步骤：</strong> 在 <code> src/pages/Home/Foo/index.tsx</code> 中包裹 <code>store.Provider</code></li></ol><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// src/pages/Home/Foo/index.tsx</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&#39;./store&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> actions<span class="token punctuation">]</span> <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">useModel</span><span class="token punctuation">(</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="版本变更说明"><a class="header-anchor" href="#版本变更说明">#</a> 版本变更说明</h2><p>icejs@1.9.7 版本开始框架推荐开发者自行初始化 store，这样可以更灵活的定制一些参数，相对之前方案带来的改变：</p><ul><li>开发者需要自行在 store.ts 中初始化 store 实例，框架默认不初始化</li></ul><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// src/store.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ice&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> user <span class="token keyword">from</span> <span class="token string">&#39;./models/user&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> project <span class="token keyword">from</span> <span class="token string">&#39;./models/project&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  user<span class="token punctuation">,</span>
  project<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>引入 store 的路径发生了变化：</li></ul><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>// 全局状态
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import { store } from &#39;ice&#39;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import store from &#39;@/store&#39;;
</span></span>
// 页面级状态
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import { store } from &#39;ice/Home&#39;;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import store from &#39;@/pages/Home/store&#39;;
</span></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>对于之前的版本我们做了向前兼容，只有当项目里存在 <code>src/store.ts</code> 或者 <code>src/pages/*/store.ts</code> 时才会触发新的方案，如果之前项目里刚好存在同名文件则有可能触发 break change。</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/ice-lab/site/edit/master/docs/guide/basic/store.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此文档"><!--[--><!--]--> 编辑此文档 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">在新窗口打开</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><span class="meta-item-info">2021/5/19 下午12:49:58</span></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/guide/basic/request.html" class="nav-link" aria-label="数据请求"><!--[--><!--]--> 数据请求 <!--[--><!--]--></a></span><span class="next"><a href="/guide/basic/build.html" class="nav-link" aria-label="工程配置"><!--[--><!--]--> 工程配置 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.244338c9.js" defer></script><script src="/assets/js/6754.6f024c79.js" defer></script><script src="/assets/js/app.0b40c029.js" defer></script>
  </body>
</html>
