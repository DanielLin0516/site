(self.webpackChunksite=self.webpackChunksite||[]).push([[4944],{6335:(n,a,s)=>{"use strict";s.r(a),s.d(a,{data:()=>t});const t={key:"v-50c99a26",path:"/guide/advanced/backend.html",title:"后端应用集成",lang:"zh-CN",frontmatter:{title:"后端应用集成",order:19},excerpt:"",headers:[{level:2,title:"Node.js 应用",slug:"node-js-应用",children:[{level:3,title:"初始化 Koa 应用",slug:"初始化-koa-应用",children:[]},{level:3,title:"定义视图",slug:"定义视图",children:[]},{level:3,title:"渲染视图",slug:"渲染视图",children:[]},{level:3,title:"运行示例",slug:"运行示例",children:[]},{level:3,title:"注意事项",slug:"注意事项",children:[]}]},{level:2,title:"Java 应用",slug:"java-应用",children:[{level:3,title:"resources",slug:"resources",children:[]},{level:3,title:"Controller",slug:"controller",children:[]}]},{level:2,title:"HTML 托管服务",slug:"html-托管服务",children:[{level:3,title:"全局安装 surge",slug:"全局安装-surge",children:[]},{level:3,title:"运行 surge",slug:"运行-surge",children:[]},{level:3,title:"其他同类产品",slug:"其他同类产品",children:[]}]}],filePathRelative:"guide/advanced/backend.md",git:{updatedTime:1621514473e3,contributors:[]}}},4868:(n,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>B});var t=s(6252);const p=(0,t.Uk)("如果是阿里内部同学，请参考 "),e={href:"https://yuque.alibaba-inc.com/ice/rdy99p/rpivf3",target:"_blank",rel:"noopener noreferrer"},o=(0,t.Uk)("文档"),c=(0,t.uE)('<hr><p>本文讲解如何在后端应用集成前端资源。</p><h2 id="node-js-应用"><a class="header-anchor" href="#node-js-应用">#</a> Node.js 应用</h2><h3 id="初始化-koa-应用"><a class="header-anchor" href="#初始化-koa-应用">#</a> 初始化 Koa 应用</h3><p>新建项目名 <code>ice-node-koa</code>，可自由指定</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> ice-node-koa <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> ice-node-koa\n$ <span class="token function">npm</span> init\n$ <span class="token function">npm</span> i ejs koa koa-logger koa-views --save\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="定义视图"><a class="header-anchor" href="#定义视图">#</a> 定义视图</h3><p>新建 <code>views/index.ejs</code>：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-ua-compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ie=edge,chrome=1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>ICE Design Lite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shortcut icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;%= publicPath %&gt;/favicon.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;%= publicPath %&gt;/css/index.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>\n\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ice-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;%= publicPath %&gt;/js/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="渲染视图"><a class="header-anchor" href="#渲染视图">#</a> 渲染视图</h3><p>新建 <code>app.js</code>：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> views <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;koa-views&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;koa&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">views</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;/views&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> extension<span class="token operator">:</span> <span class="token string">&#39;ejs&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;index&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> publicPath<span class="token operator">:</span> <span class="token string">&#39;http://localhost:4444/&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div>',12),l=(0,t.Uk)("示例兼容单页应用的 "),u=(0,t.Wm)("code",null,"HashRouter",-1),i=(0,t.Uk)(" 和 "),r=(0,t.Wm)("code",null,"BrowserRouter",-1),k=(0,t.Uk)("，如多页应用可参考 "),g={href:"https://github.com/koajs/examples",target:"_blank",rel:"noopener noreferrer"},d=(0,t.Uk)("https://github.com/koajs/examples"),m=(0,t.Uk)(" 中 blog 示例配置路由"),b=(0,t.uE)('<h3 id="运行示例"><a class="header-anchor" href="#运行示例">#</a> 运行示例</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ node app.js\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>浏览器中打开 http://localhost:3000</p><h3 id="注意事项"><a class="header-anchor" href="#注意事项">#</a> 注意事项</h3><ul><li>示例应用只部署了 html，兼容 <code>BrowserRouter</code> 做了 <code>fallback</code> 处理 (默认所有请求路径返回同一份html)</li><li>Node.js 前后端一体应用，需要进行路由配置</li></ul><h2 id="java-应用"><a class="header-anchor" href="#java-应用">#</a> Java 应用</h2><p>以 Spring Boot 为例。</p><h3 id="resources"><a class="header-anchor" href="#resources">#</a> resources</h3><p>新建 <code>/velocity/layout/index.vm</code>：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-ua-compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ie=edge,chrome=1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>ICE Design Lite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shortcut icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$!publicPath/favicon.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$!publicPath/css/index.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>\n\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ice-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$!publicPath/js/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="controller"><a class="header-anchor" href="#controller">#</a> Controller</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>\n<span class="token annotation punctuation">@VelocityLayout</span><span class="token punctuation">(</span><span class="token string">&quot;/velocity/layout/index.vm&quot;</span><span class="token punctuation">)</span>\n<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span>publicPath<span class="token punctuation">,</span> jsConfig<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>publicPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>示例展示的是 <code>HashRouter</code> 路由，如果为 <code>BrowserRouter</code>，建议改为 <code>@GetMapping(value = { &quot;/**&quot; })</code> 实现前端 fallback</p></blockquote><h2 id="html-托管服务"><a class="header-anchor" href="#html-托管服务">#</a> HTML 托管服务</h2>',14),h=(0,t.Uk)("本章节讲解如何在 HTML 托管服务中集成前端资源，我们以 "),v={href:"http://surge.sh/",target:"_blank",rel:"noopener noreferrer"},q=(0,t.Uk)("surge"),f=(0,t.Uk)(" 为例。"),y=(0,t.uE)('<h3 id="全局安装-surge"><a class="header-anchor" href="#全局安装-surge">#</a> 全局安装 surge</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --global surge\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="运行-surge"><a class="header-anchor" href="#运行-surge">#</a> 运行 surge</h3><p>以 <code>ice-demo</code> 项目名，ice 项目默认构建目录 <code>build</code> 为例：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ice-demo/build\nsurge\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div>',5),w=(0,t.Uk)("依次确认账户， "),j=(0,t.Wm)("code",null,"project path",-1),W=(0,t.Uk)("， "),x=(0,t.Wm)("code",null,"domain",-1),U=(0,t.Uk)(" 等信息，等待上传生效即可，详见 "),P={href:"https://surge.sh/",target:"_blank",rel:"noopener noreferrer"},C=(0,t.Uk)("surge"),_=(0,t.Uk)(" 官方说明"),E=(0,t.Wm)("h3",{id:"其他同类产品"},[(0,t.Wm)("a",{class:"header-anchor",href:"#其他同类产品"},"#"),(0,t.Uk)(" 其他同类产品")],-1),L={href:"http://surge.sh/",target:"_blank",rel:"noopener noreferrer"},$=(0,t.Uk)("surge"),H={href:"https://pages.github.com/",target:"_blank",rel:"noopener noreferrer"},M=(0,t.Uk)("github pages"),R={href:"https://www.netlify.com/",target:"_blank",rel:"noopener noreferrer"},T=(0,t.Uk)("netlify"),B={render:function(n,a){const s=(0,t.up)("OutboundLink");return(0,t.wg)(),(0,t.j4)(t.HY,null,[(0,t.Wm)("p",null,[p,(0,t.Wm)("a",e,[o,(0,t.Wm)(s)])]),c,(0,t.Wm)("blockquote",null,[(0,t.Wm)("p",null,[l,u,i,r,k,(0,t.Wm)("a",g,[d,(0,t.Wm)(s)]),m])]),b,(0,t.Wm)("p",null,[h,(0,t.Wm)("a",v,[q,(0,t.Wm)(s)]),f]),y,(0,t.Wm)("blockquote",null,[(0,t.Wm)("p",null,[w,j,W,x,U,(0,t.Wm)("a",P,[C,(0,t.Wm)(s)]),_])]),E,(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("a",L,[$,(0,t.Wm)(s)])]),(0,t.Wm)("li",null,[(0,t.Wm)("a",H,[M,(0,t.Wm)(s)])]),(0,t.Wm)("li",null,[(0,t.Wm)("a",R,[T,(0,t.Wm)(s)])])])],64)}}}}]);