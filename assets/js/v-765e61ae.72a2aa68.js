(self.webpackChunksite=self.webpackChunksite||[]).push([[5731],{6294:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>p});const p={key:"v-765e61ae",path:"/guide/upgrade.html",title:"版本升级",lang:"zh-CN",frontmatter:{title:"版本升级"},excerpt:"",headers:[{level:2,title:"版本说明",slug:"版本说明",children:[]},{level:2,title:"从 ice-scripts 2.x 迁移",slug:"从-ice-scripts-2-x-迁移",children:[{level:3,title:"1. 修改 package.json 依赖",slug:"_1-修改-package-json-依赖",children:[]},{level:3,title:"2. 修改配置文件",slug:"_2-修改配置文件",children:[]},{level:3,title:"3. 修改应用入口文件",slug:"_3-修改应用入口文件",children:[]},{level:3,title:"4. 其他文件修改",slug:"_4-其他文件修改",children:[]}]},{level:2,title:"从 ice-scripts 1.x 迁移",slug:"从-ice-scripts-1-x-迁移",children:[{level:3,title:"1. 修改 package.json 依赖",slug:"_1-修改-package-json-依赖-1",children:[]},{level:3,title:"2. 修改配置文件",slug:"_2-修改配置文件-1",children:[]},{level:3,title:"3. 禁用运行时能力",slug:"_3-禁用运行时能力",children:[]},{level:3,title:"更新主题配置",slug:"更新主题配置",children:[]},{level:3,title:"更新 proxyConfig",slug:"更新-proxyconfig",children:[]},{level:3,title:"更新 scripts 脚本",slug:"更新-scripts-脚本",children:[]}]}],filePathRelative:"guide/upgrade.md",git:{updatedTime:1621570108e3,contributors:[]}}},1901:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>A});var p=a(6252);const e=(0,p.Wm)("h2",{id:"版本说明"},[(0,p.Wm)("a",{class:"header-anchor",href:"#版本说明"},"#"),(0,p.Uk)(" 版本说明")],-1),t=(0,p.Wm)("p",null,[(0,p.Uk)("飞冰的脚手架从 "),(0,p.Wm)("code",null,"ice-scripts@1.x"),(0,p.Uk)(" 到 "),(0,p.Wm)("code",null,"ice-scripts@2.x"),(0,p.Uk)(" 到 icejs 经过了三个大的版本变化，这些版本变化都是结合我们的业务实践以及用户诉求不断演进的，在能力和规范性上都在不断提高，核心的一些差别：")],-1),o=(0,p.Wm)("thead",null,[(0,p.Wm)("tr",null,[(0,p.Wm)("th",null,"维度\\版本"),(0,p.Wm)("th",null,"icejs 1.x"),(0,p.Wm)("th",null,"ice-scripts 2.x"),(0,p.Wm)("th",null,"ice-scripts 1.x")])],-1),l=(0,p.Wm)("tr",null,[(0,p.Wm)("td",null,"定位"),(0,p.Wm)("td",null,"研发框架"),(0,p.Wm)("td",null,"构建工具"),(0,p.Wm)("td",null,"构建工具")],-1),c=(0,p.Wm)("tr",null,[(0,p.Wm)("td",null,"配置文件"),(0,p.Wm)("td",null,"build.json"),(0,p.Wm)("td",null,"ice.config.js"),(0,p.Wm)("td",null,"package.json(buildConfig)")],-1),u=(0,p.Wm)("td",null,"文档地址",-1),i=(0,p.Uk)("访问"),r={href:"https://github.com/alibaba/ice/tree/master/docs/guide-0.x",target:"_blank",rel:"noopener noreferrer"},k=(0,p.Uk)("访问"),d={href:"https://github.com/alibaba/ice/tree/master/docs/ice-scripts-1.x",target:"_blank",rel:"noopener noreferrer"},b=(0,p.Uk)("访问"),m=(0,p.Wm)("tr",null,[(0,p.Wm)("td",null,"发布时间"),(0,p.Wm)("td",null,"2020.02"),(0,p.Wm)("td",null,"2019.06"),(0,p.Wm)("td",null,"2018.02")],-1),g=(0,p.Wm)("tr",null,[(0,p.Wm)("td",null,"可渐进升级性"),(0,p.Wm)("td",null,"好"),(0,p.Wm)("td",null,"不好"),(0,p.Wm)("td",null,"不好")],-1),f=(0,p.Wm)("tr",null,[(0,p.Wm)("td",null,"插件能力"),(0,p.Wm)("td",null,"工程+运行时"),(0,p.Wm)("td",null,"工程"),(0,p.Wm)("td",null,"无")],-1),q=(0,p.Wm)("tr",null,[(0,p.Wm)("td",null,"工程配置"),(0,p.Wm)("td",null,"强"),(0,p.Wm)("td",null,"强"),(0,p.Wm)("td",null,"弱")],-1),h=(0,p.Wm)("tr",null,[(0,p.Wm)("td",null,"运行时配置"),(0,p.Wm)("td",null,"默认支持"),(0,p.Wm)("td",null,"默认不支持"),(0,p.Wm)("td",null,"默认不支持")],-1),x=(0,p.Wm)("tr",null,[(0,p.Wm)("td",null,"SSR"),(0,p.Wm)("td",null,"支持"),(0,p.Wm)("td",null,"不支持"),(0,p.Wm)("td",null,"不支持")],-1),j=(0,p.uE)('<blockquote><p>可渐进升级性「好」意味着整体设计较为稳定，未来的版本变化用户可以低成本的渐进升级</p></blockquote><h2 id="从-ice-scripts-2-x-迁移"><a class="header-anchor" href="#从-ice-scripts-2-x-迁移">#</a> 从 ice-scripts 2.x 迁移</h2><h3 id="_1-修改-package-json-依赖"><a class="header-anchor" href="#_1-修改-package-json-依赖">#</a> 1. 修改 package.json 依赖</h3><p>icejs 基于 build-scripts 内置了工程开发构建能力，不在需要单独依赖 ice-scripts，同时相关插件也进行了一次重构优化。</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>{\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  &quot;ice-scripts&quot;: &quot;^2.0.0&quot;,\n</span><span class="token prefix deleted">-</span><span class="token line">  &quot;ice-plugin-fusion&quot;: &quot;^0.1.4&quot;,\n</span><span class="token prefix deleted">-</span><span class="token line">  &quot;ice-plugin-moment-locales&quot;: &quot;^0.1.0&quot;,\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  &quot;ice.js&quot;: &quot;^1.0.0&quot;\n</span><span class="token prefix inserted">+</span><span class="token line">  &quot;build-plugin-fusion&quot;: &quot;^0.1.0&quot;,\n</span><span class="token prefix inserted">+</span><span class="token line">  &quot;build-plugin-moment-locales&quot;: &quot;^0.1.0&quot;,\n</span></span>}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div>',5),v={href:"https://github.com/alibaba/ice/blob/master/docs/guide-0.x/builder/plugin-list.md",target:"_blank",rel:"noopener noreferrer"},W=(0,p.Uk)("ice-scripts@2.x 插件列表"),y=(0,p.Wm)("li",null,[(0,p.Wm)("a",{href:"/plugin/list"},"icejs 插件列表")],-1),w=(0,p.uE)('<h3 id="_2-修改配置文件"><a class="header-anchor" href="#_2-修改配置文件">#</a> 2. 修改配置文件</h3><p>icejs 提供 <code>build.json</code> 文件用于工程配置，因此需要将 <code>ice.config.js</code> 配置迁移到 <code>build.json</code> 中，具体如下:</p><p>假设你的 <code>ice.config.js</code> 配置如下：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">module</span><span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  entry<span class="token operator">:</span> <span class="token string">&#39;src/index.js&#39;</span><span class="token punctuation">,</span>\n  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">[</span>\n      <span class="token string">&#39;ice-plugin-fusion&#39;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        themePackage<span class="token operator">:</span> <span class="token string">&#39;@icedesign/theme&#39;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">{</span> command <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">[</span><span class="token string">&#39;jsx&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;tsx&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      config<span class="token punctuation">.</span><span class="token keyword">module</span>\n        <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          options<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&#39;jsx-control-statements&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> options<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>新建 <code>build.json</code> 文件：（icejs 默认入口文件为 <code>app.(js|ts)</code>，因此不需要单独配置 entry）</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">[</span>\n      <span class="token string">&quot;build-plugin-fusion&quot;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token property">&quot;themePackage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@icedesign/theme&quot;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token string">&quot;./build.plugin.js&quot;</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>然后新建 <code>build.plugin.js</code> 文件，将自定义的 chainWebpack 配置移到新建的 <code>build.plugin.js</code> 中:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onGetWebpackConfig <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">onGetWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">[</span><span class="token string">&#39;jsx&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;tsx&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rule</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      config<span class="token punctuation">.</span>module\n        <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          options<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;jsx-control-statements&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> options<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>最后删除 <code>ice.config.js</code> 配置文件。</p><h3 id="_3-修改应用入口文件"><a class="header-anchor" href="#_3-修改应用入口文件">#</a> 3. 修改应用入口文件</h3><p>将原有应用入口为 <code>src/index.js</code> 需要修改为 <code>src/app.js</code>，具体修改如下：</p><p>假设你的 <code>src/index.js</code> 文件内容如下：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> <span class="token string">&#39;./global.scss&#39;</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;./router&#39;</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">ICE_CONTAINER</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;ice-container&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">ICE_CONTAINER</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;当前页面不存在 &lt;div id=&quot;ice-container&quot;&gt;&lt;/div&gt; 节点.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">ICE_CONTAINER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>新建 <code>src/app.js</code> 文件：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> runApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ice&#39;</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> appConfig <span class="token operator">=</span> <span class="token punctuation">{</span>\n  router<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">&#39;browser&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 配置 browser 路由</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">runApp</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>最后，删除 <code>src/index.js</code> 文件</p><h3 id="_4-其他文件修改"><a class="header-anchor" href="#_4-其他文件修改">#</a> 4. 其他文件修改</h3><p>icejs 规范和强约束了项目的目录结构，因此只需要按照规范就行编辑即可，不在需要额外的引用</p>',18),C=(0,p.uE)("<li>删除 <code>src/router.jsx</code> 文件</li><li>移动 <code>src/config/routes.js</code> 路由配置至 <code>src/routes.js</code> 中</li><li>在 <code>.gitignore</code> 中新增 <code>.ice/</code> 目录</li>",3),_=(0,p.Uk)("在根目录下新建 "),E=(0,p.Wm)("code",null,"tsconfig.json",-1),R=(0,p.Uk)(" 文件，"),U={href:"https://github.com/ice-lab/icejs/blob/master/examples/basic-spa/tsconfig.json",target:"_blank",rel:"noopener noreferrer"},I=(0,p.Uk)("配置详见"),N=(0,p.uE)("<li>如果项目存在 <code>src/models/*</code>、<code>src/pages/*/model.js</code> 或者 <code>src/pages/*/models/*</code> 的目录文件，需要在 <code>build.json</code> 中配置 <code>store: false</code></li><li>如果你的项目已经使用 icestore 且版本小于 1.0.0 版本，可以选择按需升级或者在 <code>build.json</code> 中配置 <code>store: false</code> 关闭内置的方案</li>",2),O=(0,p.uE)('<h2 id="从-ice-scripts-1-x-迁移"><a class="header-anchor" href="#从-ice-scripts-1-x-迁移">#</a> 从 ice-scripts 1.x 迁移</h2><h3 id="_1-修改-package-json-依赖-1"><a class="header-anchor" href="#_1-修改-package-json-依赖-1">#</a> 1. 修改 package.json 依赖</h3><p>icejs 支持了 ice-scripts 工程开发构建能力，不在需要单独依赖 ice-scripts，修改为 ice.js 即可。</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>{\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  &quot;ice-scripts&quot;: &quot;^1.0.0&quot;,\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  &quot;ice.js&quot;: &quot;^1.0.0&quot;\n</span></span>}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-修改配置文件-1"><a class="header-anchor" href="#_2-修改配置文件-1">#</a> 2. 修改配置文件</h3><p>icejs 提供 <code>build.json</code> 文件用于工程配置，因此需要将 <code>.webpackrc.js</code> 配置迁移到 <code>build.json</code> 中，假设你的 <code>.webpackrc.js</code> 配置如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  entry<span class="token operator">:</span> <span class="token string">&#39;src/index.js&#39;</span><span class="token punctuation">,</span>\n  rules<span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.s[ac]ss$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>\n      use<span class="token operator">:</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">{</span>\n          loader<span class="token operator">:</span> <span class="token string">&#39;sass-loader&#39;</span><span class="token punctuation">,</span>\n          options<span class="token operator">:</span> <span class="token punctuation">{</span>\n            sourceMap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>新建 <code>build.json</code> 文件</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>{\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  &quot;entry&quot;: &quot;src/index.js&quot;\n</span></span>}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后新建 <code>build.plugin.js</code> 文件，将自定义的插件配置移到新建的 <code>build.plugin.js</code> 中：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>  onGetWebpackConfig <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">onGetWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">[</span><span class="token string">&#39;scss&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rule</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        config<span class="token punctuation">.</span>module\n          <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span>\n          <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">)</span>\n          <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n            <span class="token operator">...</span>options<span class="token punctuation">,</span>\n            sourceMap<span class="token operator">:</span> <span class="token boolean">true</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>同时将自定义的插件引入到 <code>build.json</code> 中，最后删除 <code>.webpackrc.js</code> 配置文件。</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>{\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;entry&quot;: &quot;src/index.js&quot;,\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &quot;plugins&quot;: [\n</span><span class="token prefix inserted">+</span><span class="token line">   &quot;./build.plugin.js&quot;\n</span><span class="token prefix inserted">+</span><span class="token line"> ]\n</span></span>}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-禁用运行时能力"><a class="header-anchor" href="#_3-禁用运行时能力">#</a> 3. 禁用运行时能力</h3><p>由于 icejs 相比 ice-scripts 除了提供工程能力外，还提供了运行时扩展的能力，因此对于 ice-scripts 的项目提供了禁用运行时能力的功能，确保最小化的升级和只使用工程能力。</p><p>在 <code>build.json</code> 中配置 disableRuntime 选项即可：</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>{\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;entry&quot;: &quot;src/index.js&quot;,\n</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;plugins&quot;: [\n</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;./build.plugin.js&quot;\n</span><span class="token prefix unchanged"> </span><span class="token line"> ],\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &quot;disableRuntime&quot;: true\n</span></span>}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="更新主题配置"><a class="header-anchor" href="#更新主题配置">#</a> 更新主题配置</h3><p>如果你的 <code>package.json</code> 中存在 <code>buildConfig</code> 和 <code>themeConfig</code> 配置，则需要将该配置移置 <code>build.json</code> 文件中。</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;buildConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  <span class="token property">&quot;theme&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@icedesign/skin&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;localization&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token property">&quot;themeConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  <span class="token property">&quot;primaryColor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#908ce1&quot;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>更新后的 <code>build.json</code> 如下：</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>{\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;entry&quot;: &quot;src/index.js&quot;,\n</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;plugins&quot;: [\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   [\n</span><span class="token prefix inserted">+</span><span class="token line">     &quot;build-plugin-fusion&quot;, {\n</span><span class="token prefix inserted">+</span><span class="token line">       &quot;themePackage&quot;: &quot;@icedesign/skin&quot;,\n</span><span class="token prefix inserted">+</span><span class="token line">       &quot;themeConfig&quot;: {\n</span><span class="token prefix inserted">+</span><span class="token line">         &quot;primaryColor&quot;: &quot;#908ce1&quot;\n</span><span class="token prefix inserted">+</span><span class="token line">       }\n</span><span class="token prefix inserted">+</span><span class="token line">     }\n</span><span class="token prefix inserted">+</span><span class="token line">   ],\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   &quot;./build.plugin.js&quot;\n</span><span class="token prefix unchanged"> </span><span class="token line"> ],\n</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;disableRuntime&quot;: true\n</span></span>}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="更新-proxyconfig"><a class="header-anchor" href="#更新-proxyconfig">#</a> 更新 proxyConfig</h3><p>如果你的 <code>package.json</code> 中存在 <code>proxyConfig</code> 配置，则需要将该配置移置 <code>build.json</code> 文件中，并将 <code>proxyConfig</code> 更新为 <code>proxy</code> 。</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;proxyConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  <span class="token property">&quot;/api/**&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;enable&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pre-faraday.alibaba-inc.com&quot;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>更新后的 build.json 项如下。</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>{\n<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;entry&quot;: &quot;src/index.js&quot;,\n</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;plugins&quot;: [\n</span><span class="token prefix unchanged"> </span><span class="token line">   [\n</span><span class="token prefix unchanged"> </span><span class="token line">     &quot;build-plugin-fusion&quot;, {\n</span><span class="token prefix unchanged"> </span><span class="token line">       &quot;themePackage&quot;: &quot;@icedesign/skin&quot;,\n</span><span class="token prefix unchanged"> </span><span class="token line">       &quot;themeConfig&quot;: {\n</span><span class="token prefix unchanged"> </span><span class="token line">         &quot;primaryColor&quot;: &quot;#908ce1&quot;\n</span><span class="token prefix unchanged"> </span><span class="token line">       }\n</span><span class="token prefix unchanged"> </span><span class="token line">     }\n</span><span class="token prefix unchanged"> </span><span class="token line">   ],\n</span><span class="token prefix unchanged"> </span><span class="token line">   &quot;./build.plugin.js&quot;\n</span><span class="token prefix unchanged"> </span><span class="token line"> ],\n</span><span class="token prefix unchanged"> </span><span class="token line"> &quot;disableRuntime&quot;: true,\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &quot;proxy&quot;: {\n</span><span class="token prefix inserted">+</span><span class="token line">   &quot;/api/**&quot;: {\n</span><span class="token prefix inserted">+</span><span class="token line">     &quot;enable&quot;: true,\n</span><span class="token prefix inserted">+</span><span class="token line">     &quot;target&quot;: &quot;pre-faraday.alibaba-inc.com&quot;\n</span><span class="token prefix inserted">+</span><span class="token line">   }\n</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> }\n</span></span>}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="更新-scripts-脚本"><a class="header-anchor" href="#更新-scripts-脚本">#</a> 更新 scripts 脚本</h3><p>最后将 <code>package.json</code> 中启动项目的脚本替换如下：</p><div class="language-diff ext-diff line-numbers-mode"><pre class="language-diff"><code>&quot;scripts&quot;: {\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   &quot;start&quot;: &quot;ice dev&quot;,\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   &quot;start&quot;: &quot;icejs start&quot;,\n</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   &quot;build&quot;: &quot;ice build&quot;,\n</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   &quot;build&quot;: &quot;icejs build&quot;\n</span></span>}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>通过以上步骤即可基于 <code>ice-scripts@1.x</code> 升级到 <code>ice.js</code>，如果还存在其他配置或者升级失败，可以通过飞冰社区群与我们联系。</p>',31),A={render:function(n,s){const a=(0,p.up)("RouterLink"),A=(0,p.up)("OutboundLink");return(0,p.wg)(),(0,p.j4)(p.HY,null,[e,t,(0,p.Wm)("table",null,[o,(0,p.Wm)("tbody",null,[l,c,(0,p.Wm)("tr",null,[u,(0,p.Wm)("td",null,[(0,p.Wm)(a,{to:"/guide/baisc/start.html"},{default:(0,p.w5)((()=>[i])),_:1})]),(0,p.Wm)("td",null,[(0,p.Wm)("a",r,[k,(0,p.Wm)(A)])]),(0,p.Wm)("td",null,[(0,p.Wm)("a",d,[b,(0,p.Wm)(A)])])]),m,g,f,q,h,x])]),j,(0,p.Wm)("ul",null,[(0,p.Wm)("li",null,[(0,p.Wm)("a",v,[W,(0,p.Wm)(A)])]),y]),w,(0,p.Wm)("ul",null,[C,(0,p.Wm)("li",null,[_,E,R,(0,p.Wm)("a",U,[I,(0,p.Wm)(A)])]),N]),O],64)}}}}]);