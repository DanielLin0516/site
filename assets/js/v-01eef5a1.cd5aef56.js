(self.webpackChunksite=self.webpackChunksite||[]).push([[2775],{9590:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>e});const e={key:"v-01eef5a1",path:"/guide/advanced/prerender.html",title:"构建时预渲染 Prerender",lang:"zh-CN",frontmatter:{title:"构建时预渲染 Prerender",order:5,hide:!0},excerpt:"",headers:[{level:2,title:"安装插件",slug:"安装插件",children:[]},{level:2,title:"工程配置",slug:"工程配置",children:[{level:3,title:"在 SPA 中",slug:"在-spa-中",children:[]},{level:3,title:"在 MPA 中",slug:"在-mpa-中",children:[]}]},{level:2,title:"插件参数",slug:"插件参数",children:[]},{level:2,title:"部署到 Nginx",slug:"部署到-nginx",children:[]}],filePathRelative:"guide/advanced/prerender.md",git:{updatedTime:1621566773e3,contributors:[]}}},6848:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>p});const e=(0,a(6252).uE)('<p>在某些业务场景下，需要更好的 SEO，提高首页加载速度等等，基于此 icejs 提供了构建时预渲染（Prerender）方案。</p><h2 id="安装插件"><a class="header-anchor" href="#安装插件">#</a> 安装插件</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> build-plugin-prerender --save-dev\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="工程配置"><a class="header-anchor" href="#工程配置">#</a> 工程配置</h2><h3 id="在-spa-中"><a class="header-anchor" href="#在-spa-中">#</a> 在 SPA 中</h3><p>项目目录结构</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>├── src\n|  ├── app.ts\n|  ├── pages\n|  |  ├── About         # About 页面\n|  |  ├── Dashboard     # Dashboard 页面\n|  |  └── Home          # Home 页面\n|  └── routes.ts\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在 build.json 中引入 <code>build-plugin-prerender</code> 并配置, 其中 <code>routes</code> 为需要渲染的路由。</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">[</span>\n      <span class="token string">&quot;build-plugin-prerender&quot;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token property">&quot;routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n          <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>\n          <span class="token string">&quot;/about&quot;</span><span class="token punctuation">,</span>\n          <span class="token string">&quot;/dashboard&quot;</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>运行 <code>npm run build</code>，得到的构建产物如下：</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>├── build\n|  ├── about\n|  |  └── index.html   # 预渲染得到的 HTML\n|  ├── dashboard\n|  |  └── index.html   # 预渲染得到的 HTML\n|  ├── favicon.png\n|  ├── index.html\n|  └── js\n|     └── index.js\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>通过静态服务启动，通过预渲染后的 HTML 截图如下：</p><p><img src="https://img.alicdn.com/tfs/TB1kihJJYj1gK0jSZFOXXc7GpXa-1364-738.png" alt="prerender-html"></p><h3 id="在-mpa-中"><a class="header-anchor" href="#在-mpa-中">#</a> 在 MPA 中</h3><p>项目目录结构</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>├── public\n|  ├── dashboard.html\n|  └── index.html\n├── src\n|  └── pages\n|     ├── Dashboard    # Dashboard 页面\n|     └── Home         # Home 页面\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>首先确保在 <code>build.json</code> 中开启 MPA 应用配置，<code>build-plugin-prerender</code> 配置字段同上</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;mpa&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">[</span>\n      <span class="token string">&quot;build-plugin-prerender&quot;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token property">&quot;routes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n          <span class="token string">&quot;/about&quot;</span><span class="token punctuation">,</span>\n          <span class="token string">&quot;/dashboard&quot;</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>运行 <code>npm run build</code>，得到的构建产物如下：</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>├── build\n|  ├── dashboard\n|  |  └── index.html\n|  ├── home\n|  |  └── index.html\n|  └── js\n|     ├── dashboard.js\n|     ├── home.js\n|     └── vendor.js\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="插件参数"><a class="header-anchor" href="#插件参数">#</a> 插件参数</h2><ul><li>routes: <code>string[]</code>，需要预渲染的路由。默认是 <code>[&#39;/&#39;]</code>。</li></ul><h2 id="部署到-nginx"><a class="header-anchor" href="#部署到-nginx">#</a> 部署到 Nginx</h2><p>前端项目部署到 Nginx 时，可以在 Nginx 配置下加入以下内容，使得访问预渲染的路由时，可以获取到经过预渲染后的 HTML。</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>\n    <span class="token keyword">root</span>   www<span class="token operator">/</span>web<span class="token punctuation">;</span>\n    <span class="token keyword">index</span>  <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>\n  <span class="token operator">+</span> <span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span><span class="token operator">/</span> <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>该功能为实验性功能，如遇到问题可通过飞冰钉钉群与我们反馈。</p>',26),p={render:function(n,s){return e}}}}]);